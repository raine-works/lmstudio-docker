FROM nvidia/cuda:12.4.1-runtime-ubuntu22.04

# 1. Install dependencies for LM Studio
RUN apt-get update && apt-get install -y \
    curl \
    libfuse2 \
    libnss3 \
    libasound2 \
    && rm -rf /var/lib/apt/lists/*

# 2. Install LM Studio CLI (lms)
# We use a non-interactive shell approach for the script
RUN curl -fsSL https://lmstudio.ai/install.sh | bash

# 3. Add lms to the PATH (usually installed to ~/.cache/lm-studio/bin)
ENV PATH="/root/.cache/lm-studio/bin:${PATH}"

# 4. Expose the server port
EXPOSE 1234

# 5. Start the daemon AND the server
# 'lms server start' runs in the foreground, keeping the container alive
CMD ["/bin/bash", "-c", "lms daemon up && lms server start --port 1234 --cors=true"]
